<div id="download-btn"></div>

<%= content_for(:js_scripts) do %>
	<script type="text/javascript">
		$(document).ready(function() {
			var node = $("#download-btn");
			if (navigator.appVersion.indexOf("Mac")!=-1){
				node.html('<a class="download_btn" href="<%= mac_download_link %>"><img src="http://blog.instrumentchamp.com/wp-content/uploads/2014/01/download_ic_osx.png" alt="Download InstrumentChamp for Windows" class="downloadbutton"/></a>');
			} else {
		  	node.html('<a class="download_btn" href="<%= windows_download_link %>"><img src="http://blog.instrumentchamp.com/wp-content/uploads/2014/01/download_ic_win.png" alt="Download InstrumentChamp for Windows" class="downloadbutton"/></a>');
		  }

	  	$(".download_btn").click(function(e) {
			  var action;
			  e.preventDefault();
			  action = $(this).attr("href");
			  $("#getReady").modal("show").on("shown.bs.modal", function() {
			    window.setTimeout((function() {
			      $("#getReady").modal("hide").on("hidden.bs.modal", function() {
			        window.location = action;
			        window.focus();
			      });
			    }), 4000);
			  });
			});

			<% if params[:auto_download] %>
				$( window ).load(function() {
					$("#getReady").modal("show");
				  if (navigator.appVersion.indexOf("Mac")!=-1){
						window.location = <%= mac_download_link %>;
					} else {
				  	window.location = <%= windows_download_link %>;
				  }
				  window.focus();
				});
			<% end %>
	  });

  </script>
<% end %>

<div class="modal fade" id="getReady" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-body">
        <h3 class="text-center">Install InstrumentChamp and get your <%= display_instrument %> ready</h3>
      </div>
    </div>
  </div>
</div>